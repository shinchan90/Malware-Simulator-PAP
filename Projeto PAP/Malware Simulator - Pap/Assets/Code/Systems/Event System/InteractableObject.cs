using Ink.Runtime;
using System.Collections;
using System.Collections.Generic;
using UnityEditor;
using UnityEngine;
using UnityEngine.Events;


public class InteractableObject : MonoBehaviour
{
    public bool UseCursorInteraction = false;
    
    //Instanciamento de variáveis
    public GameEvent OnInteractable;
    [SerializeField] private DialogueEvent OnEvent;
    private TextAsset JsonFile;
    [SerializeField] private string DialogueBit;
    public LocalizationManager LocalizationManager;
    //private readonly string EnglishJsonPath = "Assets/Code/Systems/Dialogue System/English_Dialogue.json";
    private readonly string EnglishJsonPath = "English_Dialogue";
    //private readonly string PortugueseJsonPath = "Assets/Code/Systems/Dialogue System/Portuguese_Dialogue.json";
    private readonly string PortugueseJsonPath = "Portuguese_Dialogue";
    private DialogueManager dialogueManager;

    private void Start()
    {
        if (LocalizationManager.Instance == null)
        {
            Debug.Log("It's null");
        }
        else
        {
            LocalizationManager = FindObjectOfType<LocalizationManager>();

        }
        CheckDialogueSript();
        dialogueManager = FindObjectOfType<DialogueManager>();
    }
    //Executa o evento que mostra a janela de diálogo.
    public void TriggerDialogue()
    {
        //Verifica se as variáveis não são nulas antes de executar o método.

        if (OnEvent != null && JsonFile != null && DialogueBit != null)
        {
            OnEvent.Raise(JsonFile, DialogueBit);
            Debug.Log("I'm being raised");
        }
        else
        {
            Debug.Log("There are null variables");
        }
    }

    public void CheckEvent()
    {
        if (OnInteractable != null)
        {
            OnInteractable.Raise();
        }


    }

    public void CheckDialogueSript()
    {
        if (LocalizationManager != null)
        {
            if (LocalizationManager.ChosenLanguage == "English")
            {
                //JsonFile = (AssetDatabase.LoadAssetAtPath<TextAsset>(EnglishJsonPath));
                JsonFile = Resources.Load<TextAsset>(EnglishJsonPath);

            }

            else if (LocalizationManager.ChosenLanguage == "Português")
            {
                JsonFile = Resources.Load<TextAsset>(PortugueseJsonPath);
            }
        }

        else
        {

            //JsonFile = (AssetDatabase.LoadAssetAtPath<TextAsset>(EnglishJsonPath));
            JsonFile = Resources.Load<TextAsset>(EnglishJsonPath);

        }
    }
}