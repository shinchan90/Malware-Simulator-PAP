using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.EventSystems;
using UnityEngine.UI;
using UnityEngine.SceneManagement;
using UnityEditor;

public class DialogueButtonHandler : MonoBehaviour
{
    [SerializeField] private GameObject activeObject;
    [SerializeField] private GameObject textboxcauseyesgotnotchoicefr;
    [SerializeField] private DialogueEvent OnEvent;
    private TextAsset JsonFile;
    [SerializeField] private string DialogueBit;
    private bool played = false;
    private readonly string EnglishJsonPath = "Assets/Code/Systems/Dialogue System/English_Dialogue.json";
    private readonly string PortugueseJsonPath = "Assets/Code/Systems/Dialogue System/Portuguese_Dialogue.json";
    private DialogueManager dialogueManager;
    public LocalizationManager LocalizationManager;

    void Start()
    {
        dialogueManager = FindObjectOfType<DialogueManager>();
        if (LocalizationManager.Instance == null)
        {
            Debug.Log("It's null");
        }
        else
        {
            LocalizationManager = FindObjectOfType<LocalizationManager>();

        }
        LoadedScript();
        textboxcauseyesgotnotchoicefr.SetActive(true);
    }

    void Update()
    {
        if (activeObject.activeSelf && !played)
        {
            StartDiag();
            played = true;
        }
    }

    public void StartDiag()
    {
        
        OnEvent.Raise(JsonFile, DialogueBit);
        Debug.Log(JsonFile.text);
        Debug.Log(DialogueBit);
        Debug.Log("Dialogue triggered!");
    }

    private void LoadedScript()
    {
        if (LocalizationManager != null)
        {
            if (LocalizationManager.ChosenLanguage == "English")
            {
                JsonFile = (AssetDatabase.LoadAssetAtPath<TextAsset>(EnglishJsonPath));

            }

            else if (LocalizationManager.ChosenLanguage == "Português")
            {
                JsonFile = (AssetDatabase.LoadAssetAtPath<TextAsset>(PortugueseJsonPath));
            }
        }

        else
        {

            JsonFile = (AssetDatabase.LoadAssetAtPath<TextAsset>(EnglishJsonPath));

        }
    }
}
